-- Вставляем базовые услуги
INSERT INTO services (name, price, category, duration_minutes) VALUES
('Замена масла', 2000.00, 'ТО', 30),
('Замена масляного фильтра', 500.00, 'ТО', 15),
('Замена воздушного фильтра', 800.00, 'ТО', 20),
('Замена салонного фильтра', 1200.00, 'ТО', 25),
('Замена тормозных колодок', 3500.00, 'Тормоза', 60),
('Замена тормозных дисков', 5000.00, 'Тормоза', 90),
('Диагностика ходовой части', 1500.00, 'Диагностика', 45),
('Диагностика двигателя', 2000.00, 'Диагностика', 60),
('Ремонт подвески', 8000.00, 'Ходовая часть', 180),
('Ремонт двигателя', 15000.00, 'Двигатель', 300),
('Замена свечей зажигания', 2500.00, 'Двигатель', 40),
('Замена ремня ГРМ', 12000.00, 'Двигатель', 150),
('Компьютерная диагностика', 1800.00, 'Диагностика', 30),
('Шиномонтаж', 2000.00, 'Шины', 60),
('Балансировка колес', 1500.00, 'Шины', 30),
('Замена антифриза', 1800.00, 'ТО', 45),
('Замена тормозной жидкости', 2500.00, 'Тормоза', 40),
('Замена сцепления', 10000.00, 'Трансмиссия', 200),
('Ремонт коробки передач', 18000.00, 'Трансмиссия', 300),
('Замена амортизаторов', 6000.00, 'Ходовая часть', 120),
('Развал-схождение', 2500.00, 'Ходовая часть', 60),
('Замена аккумулятора', 3000.00, 'Электрика', 30),
('Ремонт генератора', 7000.00, 'Электрика', 120),
('Замена стартера', 6500.00, 'Электрика', 100),
('Ремонт кондиционера', 8000.00, 'Климат', 180),
('Заправка кондиционера', 2500.00, 'Климат', 60),
('Установка сигнализации', 5000.00, 'Доп. оборудование', 120),
('Установка ксенона', 4000.00, 'Доп. оборудование', 90),
('Полировка кузова', 8000.00, 'Кузов', 240),
('Детейлинг', 12000.00, 'Кузов', 360),
('Удаление вмятин', 5000.00, 'Кузов', 120),
('Покраска элемента', 7000.00, 'Кузов', 180),
('Замена стекла', 9000.00, 'Кузов', 150),
('Ремонт глушителя', 4000.00, 'Выхлоп', 90),
('Замена глушителя', 6000.00, 'Выхлоп', 120),
('Чистка форсунок', 3500.00, 'Топливная система', 90),
('Замена топливного фильтра', 1500.00, 'Топливная система', 30),
('Промывка инжектора', 4000.00, 'Топливная система', 120),
('Замена ремня навесного оборудования', 3000.00, 'Двигатель', 60),
('Замена помпы', 4500.00, 'Система охлаждения', 90),
('Замена термостата', 2000.00, 'Система охлаждения', 45),
('Замена радиатора', 8000.00, 'Система охлаждения', 150);

-- Вставляем пользователей (мастеров и персонал)
INSERT INTO masters (email, full_name, phone, role) VALUES
('director@vipauto.ru', 'Владимир Михайлович Орлов', '+79160000001', 'director'),
('admin@vipauto.ru', 'Роман', '+79160000002', 'admin'),
('master1@vipauto.ru', 'Владимир Чекало', '+79160000003', 'master'),
('master2@vipauto.ru', 'Владимир Архипов', '+79160000004', 'master'),
('master3@vipauto.ru', 'Андрей', '+79160000005', 'master'),
('master4@vipauto.ru', 'Алексей', '+79160000006', 'master'),
('master5@vipauto.ru', 'Артём', '+79160000007', 'master');

-- Вставляем тестовых клиентов (с правильными VIN-номерами - 17 символов)
INSERT INTO clients (name, phone, car1, car2, vin, notes) VALUES
('Иван Петров', '+79123456789', 'Toyota Camry 2018', 'Honda Civic 2020', 'JTHBE5C21A123456', 'Постоянный клиент, предпочитает качественное обслуживание'),
('Мария Сидорова', '+79123456788', 'Kia Rio 2019', NULL, 'KNADC351BP123456', 'Ценит скорость выполнения работ'),
('Алексей Кузнецов', '+79123456790', 'Lada Vesta 2021', 'Niva 2018', 'X7ADNMP1CA123456', 'Часто обращается по вопросам диагностики'),
('Елена Васильева', '+79123456791', 'Hyundai Solaris 2020', NULL, 'KMHDN51GPMA123456', 'Предпочитает записываться заранее'),
('Дмитрий Николаев', '+79123456792', 'Volkswagen Polo 2019', 'Skoda Octavia 2017', 'WVWZZZAUZNP123456', 'Интересуется установкой доп. оборудования'),
('Ольга Петрова', '+79123456793', 'Nissan Qashqai 2018', NULL, 'SJNFAAJ10U123456', 'Регулярное ТО по регламенту'),
('Сергей Смирнов', '+79123456794', 'Ford Focus 2017', 'Ford Mondeo 2015', 'WF0BXXGCABAB12345', 'Часто покупает запчасти отдельно'),
('Татьяна Иванова', '+79123456795', 'Mazda CX-5 2020', NULL, 'JM0KE2D6A0123456', 'Ценит чистоту в салоне'),
('Андрей Попов', '+79123456796', 'Renault Duster 2019', 'Renault Logan 2016', 'VF1RZ0Y063123456', 'Предпочитает экономичные решения'),
('Наталья Козлова', '+79123456797', 'Toyota RAV4 2021', NULL, 'JTBABLHES0123456', 'Семейный автомобиль, важна безопасность');

-- Создаем несколько тестовых заказов
INSERT INTO orders (client_id, services, parts_cost, services_cost, status, notes, created_by) VALUES
((SELECT id FROM clients WHERE name = 'Иван Петров'), 
'[{"service_id": (SELECT id FROM services WHERE name = "Замена масла"), "qty": 1, "price": 2000}, {"service_id": (SELECT id FROM services WHERE name = "Замена масляного фильтра"), "qty": 1, "price": 500}]',
1500, 2500, 'в_работе', 'Клиент просил использовать качественные материалы', 
(SELECT id FROM masters WHERE full_name = 'Владимир Чекало' LIMIT 1)),

((SELECT id FROM clients WHERE name = 'Мария Сидорова'), 
'[{"service_id": (SELECT id FROM services WHERE name = "Диагностика двигателя"), "qty": 1, "price": 2000}]',
0, 2000, 'диагностика', 'Проверить компрессию и электроннику', 
(SELECT id FROM masters WHERE full_name = 'Владимир Архипов' LIMIT 1)),

((SELECT id FROM clients WHERE name = 'Алексей Кузнецов'), 
'[{"service_id": (SELECT id FROM services WHERE name = "Замена тормозных колодок"), "qty": 2, "price": 3500}]',
8000, 7000, 'ожидание_деталей', 'Ждем поставку колодок с склада', 
(SELECT id FROM masters WHERE full_name = 'Андрей' LIMIT 1));

-- Распределяем мастеров по заказам
INSERT INTO order_masters (order_id, master_id, percent) VALUES
('ZA001', (SELECT id FROM masters WHERE full_name = 'Владимир Чекало' LIMIT 1), 60.00),
('ZA001', (SELECT id FROM masters WHERE full_name = 'Андрей' LIMIT 1), 40.00),
('ZA002', (SELECT id FROM masters WHERE full_name = 'Владимир Архипов' LIMIT 1), 100.00),
('ZA003', (SELECT id FROM masters WHERE full_name = 'Андрей' LIMIT 1), 70.00),
('ZA003', (SELECT id FROM masters WHERE full_name = 'Алексей' LIMIT 1), 30.00);

-- Создаем несколько продаж запчастей
INSERT INTO parts_sales (client_name, client_phone, client_id, part_name, part_number, quantity, price, discount, seller_id, notes) VALUES
('Иван Петров', '+79123456789', (SELECT id FROM clients WHERE name = 'Иван Петров'), 'Масляный фильтр Mann', 'HU716/2X', 2, 800, 100, (SELECT id FROM masters WHERE full_name = 'Владимир Чекало' LIMIT 1), 'Клиент попросил скидку'),
('Мария Сидорова', '+79123456788', (SELECT id FROM clients WHERE name = 'Мария Сидорова'), 'Тормозные колодки Brembo', 'P06021', 1, 3500, 0, (SELECT id FROM masters WHERE full_name = 'Владимир Архипов' LIMIT 1), 'Оригинальные запчасти'),
('Алексей Кузнецов', '+79123456790', (SELECT id FROM clients WHERE name = 'Алексей Кузнецов'), 'Свечи зажигания NGK', 'BKR6EIX', 4, 600, 50, (SELECT id FROM masters WHERE full_name = 'Андрей' LIMIT 1), 'Иридиевые свечи');

-- Создаем тестовые долги
INSERT INTO debts (client_id, order_id, amount, remaining, notes) VALUES
((SELECT id FROM clients WHERE name = 'Иван Петров'), 'ZA001', 4000, 2000, 'Частичная оплата при заказе'),
((SELECT id FROM clients WHERE name = 'Ольга Петрова'), NULL, 8000, 8000, 'Запчасти без заказа, обещал оплатить через неделю'),
((SELECT id FROM clients WHERE name = 'Сергей Смирнов'), NULL, 3500, 3500, 'Ремонт стартера, оплата после зарплаты');

-- Создаем тестовые оплаты
INSERT INTO payments (order_id, amount, type, created_by, notes) VALUES
('ZA001', 4000, 'карта', (SELECT id FROM masters WHERE full_name = 'Роман' LIMIT 1), 'Предоплата 50%'),
('ZA002', 2000, 'наличные', (SELECT id FROM masters WHERE full_name = 'Роман' LIMIT 1), 'Полная оплата диагностики');

INSERT INTO payments (parts_sale_id, amount, type, created_by, notes) VALUES
((SELECT id FROM parts_sales WHERE client_name = 'Иван Петров' LIMIT 1), 1500, 'карта', (SELECT id FROM masters WHERE full_name = 'Владимир Чекало' LIMIT 1), 'Оплата масляного фильтра'),
((SELECT id FROM parts_sales WHERE client_name = 'Мария Сидорова' LIMIT 1), 3500, 'перевод', (SELECT id FROM masters WHERE full_name = 'Владимир Архипов' LIMIT 1), 'Оплата через СБЕР');

-- Создаем тестовые бонусы
INSERT INTO bonuses (director_id, order_id, amount, comment) VALUES
((SELECT id FROM masters WHERE full_name = 'Владимир Михайлович Орлов' LIMIT 1), 'ZA001', 1000, 'Срочный заказ, выполнен в срок'),
((SELECT id FROM masters WHERE full_name = 'Владимир Михайлович Орлов' LIMIT 1), 'ZA002', 500, 'Сложная диагностика, найдена редкая неисправность');

-- Обновляем статистику
ANALYZE;